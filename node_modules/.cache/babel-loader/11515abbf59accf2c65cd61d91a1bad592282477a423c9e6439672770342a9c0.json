{"ast":null,"code":"import _objectSpread from\"/Users/jaikanthkamisetti/Documents/Trae/SRM AP/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useState,useEffect}from'react';import{auth,db}from'../firebase';import{createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut,onAuthStateChanged}from'firebase/auth';import{doc,setDoc,getDoc}from'firebase/firestore';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export function useAuth(){return useContext(AuthContext);}export function AuthProvider(_ref){let{children}=_ref;const[currentUser,setCurrentUser]=useState(null);const[userProfile,setUserProfile]=useState(null);const[loading,setLoading]=useState(true);const signUp=async(email,password,displayName)=>{try{const result=await createUserWithEmailAndPassword(auth,email,password);const user=result.user;// Create new user profile\nconst newUserProfile={uid:user.uid,email:user.email,displayName:displayName,photoURL:null,role:'',// Will be set during onboarding\ncreatedAt:new Date().toISOString()};await setDoc(doc(db,'users',user.uid),newUserProfile);setUserProfile(newUserProfile);return result;}catch(error){console.error('Error signing up:',error);throw error;}};const signIn=async(email,password)=>{try{const result=await signInWithEmailAndPassword(auth,email,password);const user=result.user;// Fetch user profile from Firestore\nconst userDoc=await getDoc(doc(db,'users',user.uid));if(userDoc.exists()){setUserProfile(userDoc.data());}return result;}catch(error){console.error('Error signing in:',error);throw error;}};const updateUserRole=async role=>{if(currentUser){const updatedProfile=_objectSpread(_objectSpread({},userProfile),{},{role});await setDoc(doc(db,'users',currentUser.uid),updatedProfile,{merge:true});setUserProfile(updatedProfile);}};const logout=()=>{return signOut(auth);};useEffect(()=>{const unsubscribe=onAuthStateChanged(auth,async user=>{if(user){setCurrentUser(user);// Fetch user profile from Firestore\nconst userDoc=await getDoc(doc(db,'users',user.uid));if(userDoc.exists()){setUserProfile(userDoc.data());}}else{setCurrentUser(null);setUserProfile(null);}setLoading(false);});return unsubscribe;},[]);const value={currentUser,userProfile,signUp,signIn,updateUserRole,logout};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:!loading&&children});}","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","auth","db","createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","onAuthStateChanged","doc","setDoc","getDoc","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","currentUser","setCurrentUser","userProfile","setUserProfile","loading","setLoading","signUp","email","password","displayName","result","user","newUserProfile","uid","photoURL","role","createdAt","Date","toISOString","error","console","signIn","userDoc","exists","data","updateUserRole","updatedProfile","_objectSpread","merge","logout","unsubscribe","value","Provider"],"sources":["/Users/jaikanthkamisetti/Documents/Trae/SRM AP/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport { auth, db } from '../firebase';\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'firebase/auth';\nimport { doc, setDoc, getDoc } from 'firebase/firestore';\n\nconst AuthContext = createContext();\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}\n\nexport function AuthProvider({ children }) {\n  const [currentUser, setCurrentUser] = useState(null);\n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  const signUp = async (email, password, displayName) => {\n    try {\n      const result = await createUserWithEmailAndPassword(auth, email, password);\n      const user = result.user;\n      \n      // Create new user profile\n      const newUserProfile = {\n        uid: user.uid,\n        email: user.email,\n        displayName: displayName,\n        photoURL: null,\n        role: '', // Will be set during onboarding\n        createdAt: new Date().toISOString()\n      };\n      \n      await setDoc(doc(db, 'users', user.uid), newUserProfile);\n      setUserProfile(newUserProfile);\n      \n      return result;\n    } catch (error) {\n      console.error('Error signing up:', error);\n      throw error;\n    }\n  };\n\n  const signIn = async (email, password) => {\n    try {\n      const result = await signInWithEmailAndPassword(auth, email, password);\n      const user = result.user;\n      \n      // Fetch user profile from Firestore\n      const userDoc = await getDoc(doc(db, 'users', user.uid));\n      if (userDoc.exists()) {\n        setUserProfile(userDoc.data());\n      }\n      \n      return result;\n    } catch (error) {\n      console.error('Error signing in:', error);\n      throw error;\n    }\n  };\n\n  const updateUserRole = async (role) => {\n    if (currentUser) {\n      const updatedProfile = { ...userProfile, role };\n      await setDoc(doc(db, 'users', currentUser.uid), updatedProfile, { merge: true });\n      setUserProfile(updatedProfile);\n    }\n  };\n\n  const logout = () => {\n    return signOut(auth);\n  };\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\n      if (user) {\n        setCurrentUser(user);\n        // Fetch user profile from Firestore\n        const userDoc = await getDoc(doc(db, 'users', user.uid));\n        if (userDoc.exists()) {\n          setUserProfile(userDoc.data());\n        }\n      } else {\n        setCurrentUser(null);\n        setUserProfile(null);\n      }\n      setLoading(false);\n    });\n\n    return unsubscribe;\n  }, []);\n\n  const value = {\n    currentUser,\n    userProfile,\n    signUp,\n    signIn,\n    updateUserRole,\n    logout\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {!loading && children}\n    </AuthContext.Provider>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}